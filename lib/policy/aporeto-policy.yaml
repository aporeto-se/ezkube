APIVersion: 0
data:
  externalnetworks:
    - associatedTags:
        - 'legacy:net:network=aws'
        - 'legacy:net:network=internet'
      entries:
        - 54.224.0.0/12
      name: AWS
      propagate: true
      protocols:
        - tcp
        - udp
    - annotations:
        io.aporeto/importhash:
          - '5689472362245209884'
      associatedTags:
        - 'aporeto:import:label=followermarble_python'
        - 'aporeto:import:label=otterzinc_walker'
        - 'legacy:net:network=:::CLUSTER_NAME:::-vpc'
        - 'legacy:net:network=rfc1918'
      entries:
        - 172.20.0.0/16
        - 172.31.0.0/16
      name: AWS Local VPC
      propagate: true
      protocols:
        - tcp
        - udp
    - annotations:
        io.aporeto/importhash:
          - '1785164502916343909'
      associatedTags:
        - 'aporeto:import:label=followermarble_python'
        - 'aporeto:import:label=heronspring_swallow'
        - 'aporeto:import:label=otterzinc_walker'
        - 'legacy:net:network=awsmetadataapi'
      description: AWS Metadata API
      entries:
        - 169.254.169.254/32
      name: AWS Metadata API
      propagate: true
    - annotations:
        io.aporeto/importhash:
          - '18439246324675777041'
      associatedTags:
        - 'aporeto:import:label=followermarble_python'
        - 'aporeto:import:label=heronspring_swallow'
        - 'aporeto:import:label=otterzinc_walker'
        - 'legacy:net:network=aporeto-api-console'
      description: Aporeto Console FQDN & Port
      entries:
        - api.console.aporeto.com
      name: Aporeto Console (API)
      ports:
        - '443'
      propagate: true
    - annotations:
        io.aporeto/importhash:
          - '17301212162709275354'
      associatedTags:
        - 'aporeto:import:label=followermarble_python'
        - 'aporeto:import:label=heronspring_swallow'
        - 'aporeto:import:label=otterzinc_walker'
        - 'legacy:net:service=dns'
      entries:
        - 0.0.0.0/0
      name: DNS (Local)
      ports:
        - '53'
      propagate: true
      protocols:
        - udp
        - tcp
    - annotations:
        io.aporeto/importhash:
          - '16781745386093866397'
      associatedTags:
        - 'aporeto:import:label=followermarble_python'
        - 'aporeto:import:label=heronspring_swallow'
        - 'aporeto:import:label=otterzinc_walker'
        - 'legacy:net:network=internal'
        - 'legacy:net:network=non-aporeto'
        - 'legacy:net:network=rfc1918'
      description: RFC1918 Priviate IP Network(s)
      entries:
        - 172.16.0.0/12
        - 10.0.0.0/8
        - 192.168.0.0/16
      name: RFC1918
      propagate: true
  enforcerprofiles:
    - annotations:
        io.aporeto/importhash:
          - '15623645843880394605'
      associatedTags:
        - 'aporeto:import:label=followermarble_python'
        - 'aporeto:import:label=heronspring_swallow'
        - 'aporeto:import:label=otterzinc_walker'
        - profile=operator-enforcer-profile-override
      description: Override Profile
      excludedNetworks:
        - 127.0.0.0/8
      ignoreExpression:
        - - '@app:k8s:namespace=aporeto'
      name: Operator Enforcer Profile Override
    - associatedTags:
        - profile=operator-enforcer-profile
      description: Default fallback Enforcer Profile managed by aporeto-operator
      excludedNetworks:
        - 127.0.0.0/8
      ignoreExpression:
        - - '@app:k8s:namespace=aporeto'
        - - '@app:k8s:namespace=kube-system'
      metadata:
        - '@sys:k8s:reference=operator-enforcer-profile'
        - '@profile=operator-enforcer-profile'
      name: operator-enforcer-profile
      protected: true
  enforcerprofilemappingpolicies:
    - annotations:
        io.aporeto/importhash:
          - '4598247746027090827'
      associatedTags:
        - 'aporeto:import:label=followermarble_python'
        - 'aporeto:import:label=heronspring_swallow'
        - 'aporeto:import:label=otterzinc_walker'
      description: Override Profile Mapping
      name: Operator Enforcer Profile Mapping Override
      object:
        - - profile=operator-enforcer-profile-override
      propagate: true
      subject:
        - - $namespace=/aporeto/se/demo/v1/:::CLUSTER_NAME:::
    - associatedTags:
        - profilemapping=operator-enforcer-profile-mapping
      description: Default fallback Enforcer Profile managed by aporeto-operator
      fallback: true
      metadata:
        - '@sys:k8s:reference=operator-enforcer-profile-mapping'
        - '@profilemapping=operator-enforcer-profile-mapping'
      name: operator-enforcer-profile-mapping
      object:
        - - '@profile=operator-enforcer-profile'
      protected: true
      subject:
        - - $namespace=/aporeto/se/demo/v1/:::CLUSTER_NAME:::
  networkaccesspolicies:
    - description: 'Rationalization: Access to AWS API is necessary for many functions'
      logsEnabled: true
      name: Any PU to AWS API
      object:
        - - 'legacy:net:network=aws'
      propagate: true
      subject:
        - - $enforcernamespace=/aporeto/se/demo/v1/:::CLUSTER_NAME:::
    - annotations:
        io.aporeto/importhash:
          - '7246307624619596228'
      associatedTags:
        - 'aporeto:import:label=followermarble_python'
        - 'aporeto:import:label=heronspring_swallow'
        - 'aporeto:import:label=otterzinc_walker'
      description: >-
        Rationalization: AWS Metadata access is required for many containers. It
        is a secure resource using link local IPs.
      logsEnabled: true
      name: Any PU to AWS Metadata API
      object:
        - - $namespace=/aporeto/se/demo/v1/:::CLUSTER_NAME:::
          - 'legacy:net:network=awsmetadataapi'
      propagate: true
      subject:
        - - $enforcernamespace=/aporeto/se/demo/v1/:::CLUSTER_NAME:::
    - annotations:
        io.aporeto/importhash:
          - '11479398780683654856'
      associatedTags:
        - 'aporeto:import:label=followermarble_python'
        - 'aporeto:import:label=heronspring_swallow'
        - 'aporeto:import:label=otterzinc_walker'
      description: 'Rationalization: Self explanatory'
      logsEnabled: true
      name: Any PU to DNS
      object:
        - - 'legacy:net:service=dns'
      propagate: true
      subject:
        - - $enforcernamespace=/aporeto/se/demo/v1/:::CLUSTER_NAME:::
    - annotations:
        io.aporeto/importhash:
          - '11168107521321074993'
      associatedTags:
        - 'aporeto:import:label=followermarble_python'
        - 'aporeto:import:label=heronspring_swallow'
        - 'aporeto:import:label=otterzinc_walker'
      description: Any PU may need to talk to services in K8S NS kube-system
      logsEnabled: true
      name: Any PU to NS Kube-system
      object:
        - - $enforcernamespace=/aporeto/se/demo/v1/:::CLUSTER_NAME:::
          - '@app:k8s:namespace=kube-system'
      propagate: true
      subject:
        - - $enforcernamespace=/aporeto/se/demo/v1/:::CLUSTER_NAME:::
        - - $namespace=/aporeto/se/demo/v1/:::CLUSTER_NAME:::
          - 'legacy:net:network=kube-nodes'
    - annotations:
        io.aporeto/importhash:
          - '15621467060518969963'
      associatedTags:
        - 'aporeto:import:label=followermarble_python'
        - 'aporeto:import:label=heronspring_swallow'
        - 'aporeto:import:label=otterzinc_walker'
      description: >-
        Rationalization: EC2 nodes must be able to pull images from container
        repos
      logsEnabled: true
      name: EC2 Node(s) to Internet
      object:
        - - 'legacy:net:network=internet'
      propagate: true
      subject:
        - - $enforcernamespace=/aporeto/se/demo/v1/:::CLUSTER_NAME:::
          - 'legacy:host:service=default'
    - annotations:
        io.aporeto/importhash:
          - '1483117329563591008'
      associatedTags:
        - 'aporeto:import:label=followermarble_python'
        - 'aporeto:import:label=heronspring_swallow'
        - 'aporeto:import:label=otterzinc_walker'
      description: 'Rationalization: K8S NS kube-system requires access to EC2 Host(s)'
      logsEnabled: true
      name: K8S NS kube-system to EC2 Host(s)
      object:
        - - $enforcernamespace=/aporeto/se/demo/v1/:::CLUSTER_NAME:::
          - 'legacy:host:service=default'
      propagate: true
      subject:
        - - $enforcernamespace=/aporeto/se/demo/v1/:::CLUSTER_NAME:::
          - '@app:k8s:namespace=kube-system'
    - annotations:
        io.aporeto/importhash:
          - '16107225938865549316'
      associatedTags:
        - 'aporeto:import:label=followermarble_python'
      description: >-
        Rationalization: Only authorized workloads run in K8S NS kube-system.
        Some require access to the local VPC.
      logsEnabled: true
      name: K8S NS kube-system to Local VPC
      object:
        - - 'legacy:net:network=:::CLUSTER_NAME:::-vpc'
      propagate: true
      subject:
        - - $enforcernamespace=/aporeto/se/demo/v1/:::CLUSTER_NAME:::
          - '@app:k8s:namespace=kube-system'
    - description: 'Rationalization: DHCP from VPC must able to reach EC2 Host(s)'
      logsEnabled: true
      name: VPC Internal to EC2 Host(s)
      object:
        - - $enforcernamespace=/aporeto/se/demo/v1/:::CLUSTER_NAME:::
          - 'legacy:host:service=default'
      propagate: true
      subject:
        - - 'legacy:net:network=:::CLUSTER_NAME:::-vpc'
identities:
  - enforcerprofile
  - enforcerprofilemappingpolicy
  - externalnetwork
  - networkaccesspolicy
label: Toothcream Hiss
